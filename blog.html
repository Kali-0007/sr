<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Blogs - TaxEasePro</title>
  <meta name="description" content="Latest Tax, ITR & GST Blogs | Updated for AY 2025-26">
  <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <!-- Firebase SDK (ES Modules) -->
  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.13.1/firebase-app.js';
    import { getAuth, signInWithEmailAndPassword, onAuthStateChanged, signOut } from 'https://www.gstatic.com/firebasejs/10.13.1/firebase-auth.js';
    import { getFirestore, collection, addDoc, getDocs, query, orderBy, deleteDoc, doc } from 'https://www.gstatic.com/firebasejs/10.13.1/firebase-firestore.js';
    
    // Paste your Firebase config here from console
    const firebaseConfig = {
      // Example (replace with yours):
      apiKey: "AIzaSyD...your-api-key",
      authDomain: "your-project.firebaseapp.com",
      projectId: "your-project-id",
      storageBucket: "your-project.appspot.com",
      messagingSenderId: "123456789",
      appId: "1:123456789:web:abcdef123456"
    };
    
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    
    // Globals
    let allBlogs = [];
    const ADMIN_EMAIL = 'admin@taxeasepro.com'; // Change to your email
    
    // Check URL for admin mode
    const urlParams = new URLSearchParams(window.location.search);
    const isAdminMode = urlParams.get('admin') === 'true';
    
    // Auth State
    onAuthStateChanged(auth, (user) => {
      const isAdmin = user && user.email === ADMIN_EMAIL;
      if (isAdminMode && isAdmin) {
        document.getElementById('adminSection').style.display = 'block';
      } else if (!isAdminMode) {
        // Normal users: hide admin entirely
        document.getElementById('adminSection').style.display = 'none';
      }
      loadBlogs();
    });
    
    // Sign In (if needed for write)
    document.getElementById('loginForm').addEventListener('submit', (e) => {
      e.preventDefault();
      const email = document.getElementById('email').value;
      const password = document.getElementById('password').value;
      signInWithEmailAndPassword(auth, email, password)
        .then(() => alert('Signed in! Now add blogs.'))
        .catch(error => alert('Error: ' + error.message));
    });
    
    // Logout
    document.getElementById('logoutBtn').addEventListener('click', () => {
      signOut(auth).then(() => {
        alert('Logged out!');
        window.location.href = 'blog.html'; // Redirect without ?admin=true
      });
    });
    
    // Load Blogs
    async function loadBlogs() {
      try {
        const q = query(collection(db, 'blogs'), orderBy('date', 'desc'));
        const snapshot = await getDocs(q);
        allBlogs = snapshot.docs.map(doc => ({ id: doc.id, ...doc.data() }));
        displayBlogs(allBlogs);
        displayLatestBlogs(allBlogs.slice(0, 4));
      } catch (error) {
        console.error('Load error:', error);
      }
    }
    
    // Display Blogs
    function displayBlogs(blogs) {
  const container = document.getElementById('blogsList');
  container.innerHTML = '';
  
  blogs.forEach(blog => {
    const div = document.createElement('div');
    div.className = 'glass card';
    div.style.padding = '25px';
    div.style.borderRadius = '15px';
    
    // Yahan hum sirf Title aur Excerpt dikhayenge
    div.innerHTML = `
      <h3 style="color: #00d4ff; margin-bottom: 10px;">${blog.title}</h3>
      <p style="color: #888; font-size: 13px;">${blog.date} | <span style="color: #667eea;">${blog.category}</span></p>
      <p style="color: #ddd; margin-bottom: 15px;">${blog.excerpt}</p>
      
      <a href="blog-detail.html?id=${blog.id}" style="color: #00d4ff; text-decoration: none; font-weight: bold; font-size: 14px;">
        Read Full Article <i class="fas fa-arrow-right" style="font-size: 12px; margin-left: 5px;"></i>
      </a>
    `;
    container.appendChild(div);
  });
}
    
    // Display Latest Sidebar
    function displayLatestBlogs(blogs) {
      const ul = document.getElementById('latestBlogs');
      ul.innerHTML = '';
      blogs.forEach(blog => {
        const li = document.createElement('li');
        li.innerHTML = `<a href="blog.html#blog-${blog.id}" style="color: #ddd; text-decoration: none; display: block; padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05);"><strong>${blog.title}</strong><br><small style="color: #aaa;">${blog.date} | ${blog.category}</small><br><small>${blog.excerpt}</small></a>`;
        ul.appendChild(li);
      });
    }
    
    // Add Blog
    document.getElementById('newBlogForm').addEventListener('submit', async (e) => {
      e.preventDefault();
      try {
        const newBlog = {
          title: document.getElementById('title').value,
          category: document.getElementById('category').value,
          date: new Date().toISOString().split('T')[0],
          excerpt: document.getElementById('excerpt').value,
          content: document.getElementById('content').value
        };
        await addDoc(collection(db, 'blogs'), newBlog);
        alert('Blog added!');
        document.getElementById('newBlogForm').reset();
        loadBlogs();
      } catch (error) {
        alert('Add error: ' + error.message); // Will show if not authenticated
      }
    });
    
    // Delete Blog
    window.deleteBlog = async (id) => {
      if (confirm('Delete this blog?')) {
        try {
          await deleteDoc(doc(db, 'blogs', id));
          alert('Deleted!');
          loadBlogs();
        } catch (error) {
          alert('Delete error: ' + error.message);
        }
      }
    };
    
    // Init
    loadBlogs();
  </script>
</head>
<body>
  <!-- Header, Sidebar (same as before) -->
  <!-- Hero Section -->
  <section style="padding-top: 20px; text-align: center; background: linear-gradient(135deg, #111 0%, #1a1a2e 100%); min-height: 50vh; display: flex; align-items: center; justify-content: center;">
    <div style="max-width: 1200px; padding: 0 20px;">
      <h1 style="font-size: 42px; margin-bottom: 20px; color: white;">Our Blogs</h1>
      <p style="color: #ccc; font-size: 18px;">Latest insights on Tax, ITR & GST | Updated for AY 2025-26</p>
    </div>
  </section>

  <!-- Admin Section (hidden by default, show if ?admin=true and authenticated) -->
  <div id="adminSection" style="display: none; background: rgba(255,255,255,0.05); border-radius: 20px; padding: 30px; margin-bottom: 40px;">
    <h2 style="color: #667eea;">Add New Blog</h2>
    <form id="newBlogForm">
      <input type="text" id="title" placeholder="Blog Title" style="width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 10px; background: #222; color: #fff; border: none;" required>
      <select id="category" style="width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 10px; background: #222; color: #fff; border: none;" required>
        <option value="">Select Category</option>
        <option value="ITR Tips">ITR Tips</option>
        <option value="GST Updates">GST Updates</option>
        <option value="Tax Slabs">Tax Slabs</option>
        <option value="Deductions">Deductions</option>
      </select>
      <textarea id="content" placeholder="Full Content (HTML like <p>text</p>)" rows="5" style="width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 10px; background: #222; color: #fff; border: none;" required></textarea>
      <input type="text" id="excerpt" placeholder="Short Excerpt" style="width: 100%; padding: 10px; margin-bottom: 10px; border-radius: 10px; background: #222; color: #fff; border: none;" required>
      <button type="submit" style="padding: 10px 20px; background: #00c853; color: white; border: none; border-radius: 10px;">Publish</button>
      <button id="logoutBtn" type="button" style="padding: 10px 20px; background: #ff6b6b; color: white; border: none; border-radius: 10px; margin-left: 10px;">Logout</button>
    </form>
  </div>

  <!-- Blogs List -->
  <div id="blogsList" style="display: grid; gap: 20px; max-width: 1200px; margin: 0 auto; padding: 0 20px;">
    <!-- Loaded by JS -->
  </div>

  <!-- Footer (same) -->
  <footer style="text-align: center; padding: 40px 20px; background: #000; color: #666; border-top: 1px solid #333;">
    <!-- Copy from previous -->
  </footer>

  <style>
    /* Same styles */
  </style>
</body>
</html>
