<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tax Computation Tool – TaxEasePro (FY 2025-26)</title>
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/3.0.3/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/5.0.2/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <style>
        body {
            margin: 0;
            font-family: 'Inter', sans-serif;
            background: #000;
            color: #fff;
            line-height: 1.6;
        }
        .tool-container {
            max-width: 950px;
            margin: 40px auto;
            background: #111;
            border-radius: 16px;
            box-shadow: 0 10px 40px rgba(0,0,0,0.5);
            overflow: hidden;
        }
        .tool-header {
            background: linear-gradient(135deg, #4a90e2, #357abd);
            padding: 32px;
            text-align: center;
            position: relative;
        }
        .tool-header i { font-size: 48px; margin-bottom: 12px; display: block; }
        .step-indicator {
            display: flex;
            justify-content: center;
            margin: 20px 0;
            background: #222;
        }
        .step {
            width: 45px;
            height: 45px;
            border-radius: 50%;
            background: #333;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 12px;
            font-weight: 600;
            color: #fff;
            transition: background 0.3s;
        }
        .step.active { background: #4a90e2; }
        .step.completed { background: #28a745; }
        .tool-form {
            padding: 30px;
        }
        .form-step {
            display: none;
        }
        .form-step.active { display: block; }
        .form-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
        }
        label { font-weight: 600; margin-bottom: 6px; display: block; color: #ccc; }
        input, select {
            width: 100%;
            padding: 12px;
            border-radius: 8px;
            border: 1px solid #444;
            background: #222;
            color: #fff;
            box-sizing: border-box;
            transition: border 0.3s;
        }
        input:focus, select:focus { border-color: #4a90e2; outline: none; }
        input::placeholder { color: #888; }
        .btn-group {
            display: flex;
            gap: 12px;
            margin-top: 24px;
            justify-content: center;
        }
        button {
            padding: 14px 24px;
            border-radius: 8px;
            border: none;
            font-size: 16px;
            cursor: pointer;
            font-weight: 600;
            transition: background 0.3s;
        }
        .btn-primary { background: #4a90e2; color: #fff; }
        .btn-primary:hover { background: #357abd; }
        .btn-secondary { background: #555; color: #fff; }
        .btn-secondary:hover { background: #666; }
        .reset-btn { background: #dc3545; color: #fff; width: auto; }
        .download-btns {
            display: flex;
            gap: 12px;
            justify-content: center;
            margin-top: 24px;
        }
        .download-btn { padding: 12px 20px; background: #28a745; color: #fff; }
        .download-btn:hover { background: #218838; }
        .computation-results {
            padding: 30px;
            display: none;
            background: #111;
            border-top: 1px solid #333;
        }
        .results-table {
            width: 100%;
            border-collapse: collapse;
            margin-top: 20px;
            background: #222;
        }
        .results-table th, .results-table td {
            padding: 14px;
            border-bottom: 1px solid #444;
            text-align: left;
        }
        .results-table th { background: #4a90e2; color: #fff; }
        .highlight-tax {
            color: #28a745;
            font-weight: bold;
            font-size: 18px;
        }
        .slab-breakdown {
            margin-top: 10px;
            font-size: 14px;
            color: #ccc;
            background: #333;
            padding: 8px;
            border-radius: 4px;
        }
        small { color: #888; font-size: 12px; }
        @media (max-width: 600px) {
            .form-grid { grid-template-columns: 1fr; }
            .btn-group, .download-btns { flex-direction: column; }
        }
        .close-calculator {
            position: absolute;
            top: 18px;
            right: 22px;
            background: rgba(0,0,0,0.4);
            border: none;
            color: #fff;
            font-size: 22px;
            font-weight: 600;
            width: 36px;
            height: 36px;
            border-radius: 50%;
            cursor: pointer;
            transition: background 0.3s, transform 0.2s;
        }
        .close-calculator:hover {
            background: #dc3545;
            transform: scale(1.1);
        }
    </style>
</head>
<body>
    <div class="tool-container">
        <header class="tool-header">
            <i class="fas fa-calculator"></i>
            <h1>Tax Computation Tool</h1>
            <div>Pro Tax, Zero Stress</div>
            <button class="close-calculator" onclick="closeCalculator()">✕</button>
        </header>
        <div class="step-indicator" id="stepIndicator">
            <div class="step active" data-step="1">1</div>
            <div class="step" data-step="2">2</div>
            <div class="step" data-step="3">3</div>
            <div class="step" data-step="4">4</div>
        </div>
        <form id="taxForm" class="tool-form">
            <div class="form-step active" data-step="1">
                <h3><i class="fas fa-user"></i> Step 1: Tax Profile</h3>
                <div class="form-grid">
                    <div>
                        <label>Your Name (Optional)</label>
                        <input type="text" id="userName" placeholder="e.g., John Doe">
                    </div>
                    <div>
                        <label>Select Your Category <span style="color:#ff6b6b;">(Required)</span></label>
                        <select id="userCategory" required>
                            <option value="">Please select</option>
                            <option value="salaried">Salaried Employee</option>
                            <option value="business">Business Owner / Proprietor</option>
                            <option value="freelancer">Freelancer / Professional (CA, Doctor, Lawyer, Consultant etc.)</option>
                            <option value="investor">Investor / Rental Income Only</option>
                            <option value="other">Other</option>
                        </select>
                    </div>
                    <div>
                        <label>Age Category</label>
                        <select id="ageGroup">
                            <option value="under60">Below 60 years</option>
                            <option value="senior">60-79 years (Senior)</option>
                            <option value="superSenior">80+ years (Super Senior)</option>
                        </select>
                    </div>
                    <div>
                        <label>Residency</label>
                        <select id="residentialStatus">
                            <option value="resident">Resident Indian</option>
                            <option value="nri">Non-Resident Indian</option>
                        </select>
                    </div>
                    <div style="grid-column: 1 / -1;">
                        <label>Annual Salary (pre-exemptions, ₹)</label>
                        <input type="text" id="totalSalary" value="0" placeholder="e.g., 1000000" oninput="formatNumber(this)">
                        <small>Basic pay + allowances</small>
                    </div>
                    <div>
                        <label>HRA Relief (₹)</label>
                        <input type="text" id="hraExemption" value="0" oninput="formatNumber(this)">
                    </div>
                    <div>
                        <label>Additional Exemptions (₹)</label>
                        <input type="text" id="otherExemptions" value="0" oninput="formatNumber(this)">
                    </div>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn-secondary" onclick="nextStep(2)">Next</button>
                </div>
            </div>
            <div class="form-step" data-step="2">
                <h3><i class="fas fa-chart-line"></i> Step 2: Income Streams</h3>
                <div class="form-grid">
                    <div>
                        <label>Other Earnings (₹)</label>
                        <input type="text" id="otherIncome" value="0" oninput="formatNumber(this)">
                    </div>
                    <div>
                        <label>Rent Received (₹)</label>
                        <input type="text" id="rentalIncome" value="0" oninput="formatNumber(this)">
                    </div>
                    <div>
                        <label>Capital Gains (₹)</label>
                        <input type="text" id="capitalGains" value="0" oninput="formatNumber(this)">
                    </div>
                    <div>
                        <label>Business Earnings (₹)</label>
                        <input type="text" id="businessIncome" value="0" oninput="formatNumber(this)">
                    </div>
                    <div>
                        <label>Property Loan Interest - Rented (₹)</label>
                        <input type="text" id="homeLoanLetOut" value="0" oninput="formatNumber(this)">
                    </div>
                    <div>
                        <label>Property Loan Interest - Owned (max ₹2L, ₹)</label>
                        <input type="text" id="homeLoanSelf" value="0" max="200000" oninput="formatNumber(this)">
                    </div>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn-secondary" onclick="prevStep(1)">Previous</button>
                    <button type="button" class="btn-primary" onclick="nextStep(3)">Next</button>
                </div>
            </div>
            <div class="form-step" data-step="3">
                <h3><i class="fas fa-shield-alt"></i> Step 3: Allowable Deductions (Traditional Regime)</h3>
                <p style="color: #ccc;">New regime limits to standard deduction only.</p>
                <div class="form-grid">
                    <div>
                        <label>80C Investments (max ₹1.5L, ₹)</label>
                        <input type="text" id="section80C" value="0" max="150000" oninput="formatNumber(this)">
                    </div>
                    <div>
                        <label>80D Insurance (max ₹50K, ₹)</label>
                        <input type="text" id="section80D" value="0" max="50000" oninput="formatNumber(this)">
                    </div>
                    <div>
                        <label>80G Contributions (₹)</label>
                        <input type="text" id="section80G" value="0" oninput="formatNumber(this)">
                    </div>
                    <div>
                        <label>80E Loan Interest (₹)</label>
                        <input type="text" id="section80E" value="0" oninput="formatNumber(this)">
                    </div>
                    <div>
                        <label>80TTA Savings (max ₹10K, ₹)</label>
                        <input type="text" id="section80TTA" value="0" max="10000" oninput="formatNumber(this)">
                    </div>
                    <div style="grid-column: 1 / -1;">
                        <label>Further Deductions (₹)</label>
                        <input type="text" id="otherDeductions" value="0" oninput="formatNumber(this)">
                    </div>
                </div>
                <div class="btn-group">
                    <button type="button" class="btn-secondary" onclick="prevStep(2)">Previous</button>
                    <button type="button" id="generateBtn" class="btn-primary">Generate Report</button>
                </div>
            </div>
        </form>
        <div id="results" class="computation-results">
            <h2><i class="fas fa-file-invoice"></i> Computation Summary</h2>
            <table class="results-table">
                <thead>
                    <tr>
                        <th>Component</th>
                        <th>Traditional Regime</th>
                        <th>New Regime</th>
                    </tr>
                </thead>
                <tbody id="resultsTable">
                </tbody>
            </table>
            <div class="download-btns">
                <button class="download-btn" onclick="downloadPDF()"><i class="fas fa-file-pdf"></i> Download as PDF</button>
                <button class="download-btn" onclick="downloadExcel()"><i class="fas fa-file-excel"></i> Download as Excel</button>
            </div>
            <button type="button" class="reset-btn" onclick="resetForm()" style="margin-top: 20px; display: block; margin-left: auto; margin-right: auto;">New Computation</button>
        </div>
    </div>
    <script>
    function formatNumber(input) {
        let value = input.value.replace(/,/g, '');
        if (!isNaN(value) && value !== '') {
            let num = parseFloat(value);
            input.value = new Intl.NumberFormat('en-IN').format(num);
        }
    }

    function parseFormatted(value) {
        return parseFloat(value.replace(/,/g, '')) || 0;
    }

    function formatINR(n) {
        return new Intl.NumberFormat('en-IN', { maximumFractionDigits: 0 }).format(Math.round(n || 0));
    }

    function updateSteps(currentStep) {
        document.querySelectorAll('.step').forEach((step, index) => {
            step.classList.remove('active', 'completed');
            if (index < currentStep - 1) step.classList.add('completed');
            if (index === currentStep - 1) step.classList.add('active');
        });
        document.querySelectorAll('.form-step').forEach((s, i) => {
            s.classList.toggle('active', i === currentStep - 1);
        });
    }

    function nextStep(step) { updateSteps(step); }
    function prevStep(step) { updateSteps(step); }
    function closeCalculator() {}
    function resetForm() {
        document.getElementById('taxForm').reset();
        document.getElementById('results').style.display = 'none';
        updateSteps(1);
        delete window.taxData;
    }

    updateSteps(1);

    function calculateTax(income, regime, ageGroup, isResident) {
        let tax = 0;
        let slabs = [];
        let rebate = 0;
        let preRebateTax = 0;
      
        let stdDeduction = regime === 'old' ? 50000 : 75000;
        let totalTaxable = Math.max(0, income - stdDeduction);
      
        if (regime === 'new') {
            if (totalTaxable <= 400000) {
                preRebateTax = 0;
            } else if (totalTaxable <= 800000) {
                preRebateTax = (totalTaxable - 400000) * 0.05;
                slabs.push('5% on ₹4L-₹8L');
            } else if (totalTaxable <= 1200000) {
                preRebateTax = 20000 + (totalTaxable - 800000) * 0.10;
                slabs.push('5% on ₹4L-₹8L', '10% on ₹8L-₹12L');
            } else if (totalTaxable <= 1600000) {
                preRebateTax = 60000 + (totalTaxable - 1200000) * 0.15;
                slabs.push('5% on ₹4L-₹8L', '10% on ₹8L-₹12L', '15% on ₹12L-₹16L');
            } else if (totalTaxable <= 2000000) {
                preRebateTax = 120000 + (totalTaxable - 1600000) * 0.20;
                slabs.push('5% on ₹4L-₹8L', '10% on ₹8L-₹12L', '15% on ₹12L-₹16L', '20% on ₹16L-₹20L');
            } else if (totalTaxable <= 2400000) {
                preRebateTax = 200000 + (totalTaxable - 2000000) * 0.25;
                slabs.push('5% on ₹4L-₹8L', '10% on ₹8L-₹12L', '15% on ₹12L-₹16L', '20% on ₹16L-₹20L', '25% on ₹20L-₹24L');
            } else {
                preRebateTax = 300000 + (totalTaxable - 2400000) * 0.30;
                slabs.push('5% on ₹4L-₹8L', '10% on ₹8L-₹12L', '15% on ₹12L-₹16L', '20% on ₹16L-₹20L', '25% on ₹20L-₹24L', '30% above ₹24L');
            }
            if (isResident && totalTaxable <= 1200000) {
                rebate = preRebateTax;
            }
        } else {
            let exemptionLimit = ageGroup === 'under60' ? 250000 : ageGroup === 'senior' ? 300000 : 500000;
            slabs = [];
            preRebateTax = 0;
          
            if (totalTaxable > exemptionLimit) {
                const fiveEnd = Math.min(totalTaxable, 500000);
                const fiveAmount = fiveEnd - exemptionLimit;
                if (fiveAmount > 0) {
                    preRebateTax += fiveAmount * 0.05;
                    slabs.push(`5% on ₹${(exemptionLimit / 1000).toFixed(0)}L - ₹5L`);
                }
              
                if (totalTaxable > 500000) {
                    const twentyEnd = Math.min(totalTaxable, 1000000);
                    const twentyAmount = twentyEnd - 500000;
                    preRebateTax += twentyAmount * 0.20;
                    slabs.push('20% on ₹5L - ₹10L');
                }
              
                if (totalTaxable > 1000000) {
                    const thirtyAmount = totalTaxable - 1000000;
                    preRebateTax += thirtyAmount * 0.30;
                    slabs.push('30% above ₹10L');
                }
            }
          
            if (isResident && totalTaxable <= 500000) {
                rebate = Math.min(preRebateTax, 12500);
            }
        }
        tax = Math.max(0, preRebateTax - rebate);
        let surcharge = 0;
        if (totalTaxable > 5000000) {
            let surchargeRate = 0;
            if (totalTaxable <= 10000000) surchargeRate = 0.10;
            else if (totalTaxable <= 20000000) surchargeRate = 0.15;
            else if (totalTaxable <= 50000000) surchargeRate = 0.25;
            else surchargeRate = regime === 'new' ? 0.25 : 0.37;
            surcharge = tax * surchargeRate;
        }
        let finalTax = (tax + surcharge) * 1.04;
        return {
            tax: Math.round(finalTax),
            preRebateTax: Math.round(preRebateTax),
            rebateAmount: Math.round(rebate),
            slabs: slabs.join(', '),
            stdDeduction,
            taxableIncome: Math.round(totalTaxable)
        };
    }

    document.addEventListener('DOMContentLoaded', function() {
        document.getElementById('generateBtn').addEventListener('click', function(e) {
            e.preventDefault();
            const userName = document.getElementById('userName').value.trim() || 'User';
            const userCategory = document.getElementById('userCategory').value;
            if (!userCategory) {
                alert('Please select your category.');
                return;
            }
            const ageGroup = document.getElementById('ageGroup').value;
            const isResident = document.getElementById('residentialStatus').value === 'resident';
            const basicSalary = parseFormatted(document.getElementById('totalSalary').value);
            const otherIncome = parseFormatted(document.getElementById('otherIncome').value);
            const rentalIncome = parseFormatted(document.getElementById('rentalIncome').value);
            const homeLoanLetOut = parseFormatted(document.getElementById('homeLoanLetOut').value);
            const hraExemption = parseFormatted(document.getElementById('hraExemption').value);
            const otherExemptions = parseFormatted(document.getElementById('otherExemptions').value);
            const section80C = parseFormatted(document.getElementById('section80C').value);
            const section80D = parseFormatted(document.getElementById('section80D').value);
            const section80G = parseFormatted(document.getElementById('section80G').value);
            const section80E = parseFormatted(document.getElementById('section80E').value);
            const section80TTA = parseFormatted(document.getElementById('section80TTA').value);
            const homeLoanSelf = parseFormatted(document.getElementById('homeLoanSelf').value);
            const furtherDeductions = parseFormatted(document.getElementById('otherDeductions').value);
            const totalIncomeSource = basicSalary + otherIncome + (rentalIncome - homeLoanLetOut);
           
            const oldRegimeDeductions = section80C + section80D + section80G + section80E + section80TTA + homeLoanSelf + hraExemption + otherExemptions + furtherDeductions;
            let oldResult = calculateTax(totalIncomeSource - oldRegimeDeductions, 'old', ageGroup, isResident);
            let newResult = calculateTax(totalIncomeSource, 'new', ageGroup, isResident);
           
            window.taxData = {
                timestamp: new Date().toLocaleString('en-IN'),
                userName: userName,
                userCategory: userCategory,
                grossIncome: totalIncomeSource,
                oldStd: oldResult.stdDeduction,
                newStd: newResult.stdDeduction,
                deductions: oldRegimeDeductions,
                oldTaxable: oldResult.taxableIncome,
                newTaxable: newResult.taxableIncome,
                oldPreRebate: oldResult.preRebateTax,
                newPreRebate: newResult.preRebateTax,
                oldRebate: oldResult.rebateAmount,
                newRebate: newResult.rebateAmount,
                oldTax: oldResult.tax,
                newTax: newResult.tax,
                savings: Math.abs(oldResult.tax - newResult.tax),
                recommendedRegime: oldResult.tax > newResult.tax ? 'New' : 'Traditional',
                oldSlabs: oldResult.slabs,
                newSlabs: newResult.slabs
            };
           
            const regimeAdvantage = oldResult.tax - newResult.tax;
            const recommendedRegime = oldResult.tax > newResult.tax ? 'New' : 'Traditional';
            document.getElementById('resultsTable').innerHTML = `
                <tr><td>Gross Earnings</td><td>${formatINR(totalIncomeSource)}</td><td>${formatINR(totalIncomeSource)}</td></tr>
                <tr><td>Exemptions & Deductions</td><td>-${formatINR(oldRegimeDeductions)}</td><td>Not Allowed</td></tr>
                <tr><td>Standard Deduction</td><td>-${formatINR(oldResult.stdDeduction)}</td><td>-${formatINR(newResult.stdDeduction)}</td></tr>
                <tr><td style="font-weight:bold">Net Taxable Income</td><td>${formatINR(oldResult.taxableIncome)}</td><td>${formatINR(newResult.taxableIncome)}</td></tr>
                <tr><td>Tax Before Rebate</td><td>${formatINR(oldResult.preRebateTax)}</td><td>${formatINR(newResult.preRebateTax)}</td></tr>
                <tr><td>87A Rebate</td><td>${formatINR(oldResult.rebateAmount)}</td><td>${formatINR(newResult.rebateAmount)}</td></tr>
                <tr><td>Final Tax (incl. Cess)</td><td style="font-size:20px">${formatINR(oldResult.tax)}</td><td style="font-size:20px">${formatINR(newResult.tax)}</td></tr>
                <tr><td>Recommendation</td><td colspan="2" style="text-align:center; color:green; font-weight:bold;">
                    ${regimeAdvantage === 0 ? "Equal" : `Save ₹${formatINR(Math.abs(regimeAdvantage))} with ${recommendedRegime} Regime`}
                </td></tr>
            `;
            document.getElementById('results').style.display = 'block';
            updateSteps(4);
        });
    });

    function downloadPDF() {
        if (typeof window.taxData === 'undefined') {
            alert('Please calculate tax first.');
            return;
        }
        const { jsPDF } = window.jspdf;
        const doc = new jsPDF('p', 'mm', 'a4');
        const g = window.taxData;
        
        // Header
        doc.setFillColor(0, 51, 102);
        doc.rect(0, 0, 210, 40, 'F');
        
        const logo = new Image();
        logo.src = 'logo.png';
        let logoLoaded = false;

        logo.onload = function () {
            doc.addImage(logo, 'PNG', 10, 5, 25, 25);
            logoLoaded = true;
            renderContent();
        };

        logo.onerror = function () {
            logoLoaded = false;
            renderContent();
        };

        setTimeout(() => {
            if (!logoLoaded) renderContent();
        }, 1000);

        function renderContent() {
            const xOffset = logoLoaded ? 45 : 10;

            doc.setTextColor(255, 255, 255);
            doc.setFont('helvetica', 'bold');
            doc.setFontSize(20);
            doc.text('TaxEasePro', xOffset, 18);

            doc.setFontSize(11);
            doc.text('Tax Computation Report (FY 2025-26)', xOffset, 26);

            doc.setFontSize(9);
            doc.text('Email: support@taxeasepro.com', xOffset, 34);
            doc.text('WhatsApp: +91 98765 43210', xOffset + 60, 34);

            // Main content
            doc.setTextColor(0);
            let y = 50;

            doc.setFontSize(14);
            doc.setTextColor(0, 51, 102);
            doc.text(`Hello ${g.userName}! Here is your Tax Summary`, 15, y);
            y += 12;

            const recommended = g.recommendedRegime;
            const advantage = g.savings;

            const tableData = [
                ['Component', 'Traditional (₹)', 'New Regime (₹)'],
                ['Gross Earnings', formatINR(g.grossIncome), formatINR(g.grossIncome)],
                ['Standard Deduction', formatINR(g.oldStd), formatINR(g.newStd)],
                ['Deductions Applied', formatINR(g.deductions), '₹0'],
                ['Taxable Income', formatINR(g.oldTaxable), formatINR(g.newTaxable)],
                ['Tax Before Rebate', formatINR(g.oldPreRebate), formatINR(g.newPreRebate)],
                ['87A Rebate', formatINR(g.oldRebate), formatINR(g.newRebate)],
                ['Final Tax (incl. Cess)', formatINR(g.oldTax), formatINR(g.newTax)],
                ['Recommendation', `Save ₹${formatINR(advantage)} with ${recommended}`, '']
            ];

            doc.autoTable({
                startY: y,
                head: [tableData[0]],
                body: tableData.slice(1),
                theme: 'grid',
                styles: { 
                    fontSize: 8, 
                    cellPadding: 3, 
                    overflow: 'linebreak',
                    halign: 'left',
                    valign: 'middle'
                },
                headStyles: { 
                    fillColor: [0, 51, 102], 
                    textColor: [255,255,255],
                    fontSize: 9
                },
                columnStyles: { 
                    0: { cellWidth: 52 }, 
                    1: { cellWidth: 68 }, 
                    2: { cellWidth: 68 } 
                },
                margin: { left: 12, right: 12, top: y }
            });

            y = doc.lastAutoTable.finalY + 12;

            // Bottom section with proper margins
            if (y > 250) {
                doc.addPage();
                y = 20;
            }

            doc.setFillColor(240, 240, 240);
            doc.rect(5, y - 3, 200, 270 - y + 5, 'F');

            doc.setFontSize(12);
            doc.setTextColor(40, 167, 69);
            doc.text("Your Personalized Tax Saving Tips", 105, y, { align: 'center' });
            y += 10;

            doc.setFontSize(10);
            doc.setTextColor(0);

            let summaryLine = "";
            let tip1 = "";
            let tip2 = "";
            let tip3 = "";
            const oldTax = g.oldTax;
            const newTax = g.newTax;
            const minTax = Math.min(oldTax, newTax);
            const category = g.userCategory;

            if (minTax === 0) {
                summaryLine = "Great! Your tax is ₹0 this year.";
                tip1 = `Stay tax-free next year with smart planning.`;
            } else if (minTax < 50000) {
                summaryLine = `Your tax is low at ₹${formatINR(minTax)} – Well done!`;
                tip1 = `Optimize further to keep it under ₹25,000.`;
            } else if (minTax < 200000) {
                summaryLine = `You're paying ₹${formatINR(minTax)} tax – Save more!`;
                tip1 = `Invest ₹1.5 Lakh in eligible options to reduce it by 30%.`;
            } else {
                summaryLine = `High tax of ₹${formatINR(minTax)} – Time to act!`;
                tip1 = `Switch regimes or claim deductions to save ₹50,000+.`;
            }

            if (recommended === 'Traditional') {
                tip2 = `Traditional saves you ₹${formatINR(advantage)} – Maximize 80C/80D.`;
            } else {
                tip2 = `New Regime saves you ₹${formatINR(advantage)} – Consider NPS.`;
            }

            if (category === "salaried") {
                tip3 = "Salaried: Focus on HRA, Home Loan, and NPS deductions.";
            } else if (category === "business") {
                tip3 = "Business: Use Presumptive Taxation (44AD) + GST optimization.";
            } else if (category === "freelancer") {
                tip3 = "Freelancer: Claim 44ADA + manage TDS/GST threshold.";
            } else if (category === "investor") {
                tip3 = "Investor: Reinvest Capital Gains under 54/54F.";
            } else {
                tip3 = "Tailored advice available – Book a call!";
            }

            doc.text(summaryLine, 12, y);
            y += 8;
            doc.text("• " + tip1, 12, y); y += 7;
            doc.text("• " + tip2, 12, y); y += 7;
            doc.text("• " + tip3, 12, y); y += 10;

            doc.setFontSize(9);
            doc.text("Our Services:", 12, y);
            y += 7;
            doc.text("• ITR Filing + TDS Refund", 18, y); y += 6;
            doc.text("• GST Return + Compliance", 18, y); y += 6;
            doc.text("• Tax Saving Planning", 18, y); y += 6;
            doc.text("• Notice/Scrutiny Handling", 18, y); y += 12;

            doc.setTextColor(0);
            doc.setFont('helvetica', 'normal');
            doc.setFontSize(11);
            doc.text("WhatsApp: wa.me/919876543210", 105, y, { align: 'center' });
            y += 7;
            doc.text("Call: +91 98765 43210", 105, y, { align: 'center' });
            y += 7;
            doc.text("www.taxeasepro.com", 105, y, { align: 'center' });

            y += 12;
            doc.setFontSize(9);
            doc.setTextColor(100);
            doc.text("Share this report with friends & family!", 105, y, { align: 'center' });
            y += 8;

            doc.setTextColor(120);
            doc.text("System-generated report. Consult qualified CA for decisions.", 105, y, { align: 'center' });

            doc.save(`TaxEasePro_Tax_Report_${g.userName}_FY_2025-26.pdf`);
        }
    }

    function downloadExcel() {
        if (!window.taxData) {
            alert('Please generate computation first');
            return;
        }
        const wsData = [
            ["INCOME TAX COMPUTATION – FY 2025-26 (AY 2026-27)"],
            [],
            ["Particulars", "Traditional Regime (₹)", "New Regime (₹)"],
            ["Gross Total Income", window.taxData.grossIncome, window.taxData.grossIncome],
            ["Less: Deductions", window.taxData.deductions, 0],
            ["Taxable Income", window.taxData.oldTaxable, window.taxData.newTaxable],
            [],
            ["Income Tax Payable"],
            ["Final Tax Liability (incl. cess)", window.taxData.oldTax, window.taxData.newTax],
            [],
            [
                "Recommended Regime",
                window.taxData.oldTax > window.taxData.newTax ? "New Regime" : "Traditional Regime",
                ""
            ],
            [],
            ["Generated on", window.taxData.timestamp]
        ];
        const ws = XLSX.utils.aoa_to_sheet(wsData);
        const wb = XLSX.utils.book_new();
        XLSX.utils.book_append_sheet(wb, ws, "Tax Computation");
        XLSX.writeFile(wb, "TaxEasePro_Income_Tax_Computation_FY_2025_26.xlsx");
    }
    </script>
</body>
</html>
